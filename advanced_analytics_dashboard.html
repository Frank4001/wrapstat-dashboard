<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WrapStat Advanced Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
            color: #2c2c2c;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, #1c4585 0%, #2d5aa0 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .nav-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 3px solid #1c4585;
            background: white;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .tab-button {
            background: white;
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 600;
            color: #1c4585;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            flex: 1;
            text-align: center;
        }
        
        .tab-button:hover {
            background: #f8f9fa;
        }
        
        .tab-button.active {
            background: #1c4585;
            color: white;
            border-bottom-color: #1c4585;
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .analytics-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #1c4585;
        }
        
        .card-title {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1c4585;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .metric-label {
            font-weight: 500;
        }
        
        .metric-value {
            font-weight: 700;
            color: #1c4585;
        }
        
        .prediction-input {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .predict-button {
            background: #1c4585;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .predict-button:hover {
            background: #0f2a4a;
        }
        
        .prediction-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            font-weight: 600;
        }
        
        .recommendation-item {
            background: #e8f4f8;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #77b8e0;
            border-radius: 5px;
        }
        
        .recommendation-item.high-priority {
            background: #fff3cd;
            border-left-color: #efbe1b;
        }
        
        .recommendation-item.urgent {
            background: #f8d7da;
            border-left-color: #f15b28;
        }
        
        .segment-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .segment-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #1c4585;
            margin-bottom: 10px;
        }
        
        .chart-container {
            height: 400px;
            margin: 20px 0;
        }
        
        .correlation-heatmap {
            height: 500px;
        }
        
        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: 500;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #b3d7dc;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #6c757d;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #1c4585 0%, #2d5aa0 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🧠 WrapStat Advanced Analytics</h1>
        <p>Machine Learning & AI-Powered Training Insights</p>
    </div>

    <div class="nav-tabs">
        <button class="tab-button active" onclick="showTab('predictive')">🔮 Predictive Analytics</button>
        <button class="tab-button" onclick="showTab('clustering')">👥 Participant Segments</button>
        <button class="tab-button" onclick="showTab('correlations')">📊 Correlations</button>
        <button class="tab-button" onclick="showTab('recommendations')">💡 AI Recommendations</button>
        <button class="tab-button" onclick="showTab('anomalies')">🚨 Anomaly Detection</button>
        <button class="tab-button" onclick="showTab('insights')">📈 Statistical Insights</button>
    </div>

    <!-- Predictive Analytics Tab -->
    <div id="predictive" class="tab-content active">
        <div class="card-title">🔮 Predictive Models</div>
        
        <div class="analytics-grid">
            <div class="analytics-card">
                <h3>Knowledge Improvement Predictor</h3>
                <div class="prediction-input">
                    <div class="input-group">
                        <label>Content Engagement (1-5):</label>
                        <input type="range" id="content-engaging" min="1" max="5" value="4" oninput="updatePrediction()">
                        <span id="engaging-value">4</span>
                    </div>
                    <div class="input-group">
                        <label>Content Relevance (1-5):</label>
                        <input type="range" id="content-relevant" min="1" max="5" value="4" oninput="updatePrediction()">
                        <span id="relevant-value">4</span>
                    </div>
                    <div class="input-group">
                        <label>Visual Support Quality (1-5):</label>
                        <input type="range" id="visual-support" min="1" max="5" value="4" oninput="updatePrediction()">
                        <span id="visual-value">4</span>
                    </div>
                    <div class="input-group">
                        <label>Training Duration (minutes):</label>
                        <input type="range" id="duration" min="0.5" max="5" step="0.1" value="1.5" oninput="updatePrediction()">
                        <span id="duration-value">1.5</span>
                    </div>
                    <div class="prediction-result" id="prediction-result">
                        Predicted Knowledge Improvement: <strong>+1.8 points</strong>
                    </div>
                </div>
            </div>
            
            <div class="analytics-card">
                <h3>Model Performance Metrics</h3>
                <div class="metric-row">
                    <span class="metric-label">R² Score:</span>
                    <span class="metric-value">0.137 (13.7% variance explained)</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">RMSE:</span>
                    <span class="metric-value">0.894 points</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Training Samples:</span>
                    <span class="metric-value">38 responses</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Top Predictor:</span>
                    <span class="metric-value">Training Duration (30.7%)</span>
                </div>
            </div>
        </div>
        
        <div class="chart-container">
            <canvas id="feature-importance-chart"></canvas>
        </div>
    </div>

    <!-- Clustering Tab -->
    <div id="clustering" class="tab-content">
        <div class="card-title">👥 Participant Segmentation Analysis</div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">3</div>
                <div class="stat-label">Segments Identified</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">87%</div>
                <div class="stat-label">Classification Accuracy</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">5</div>
                <div class="stat-label">Key Features Used</div>
            </div>
        </div>
        
        <div class="analytics-grid">
            <div class="segment-card">
                <div class="segment-title">🎯 Segment 1: High Performers (n=7)</div>
                <div class="metric-row">
                    <span>Initial Knowledge:</span>
                    <span class="metric-value">3.86/5 (High baseline)</span>
                </div>
                <div class="metric-row">
                    <span>Knowledge Improvement:</span>
                    <span class="metric-value">+0.57 points (Moderate)</span>
                </div>
                <div class="metric-row">
                    <span>Content Satisfaction:</span>
                    <span class="metric-value">4.55/5 (Excellent)</span>
                </div>
                <div class="metric-row">
                    <span>Training Duration:</span>
                    <span class="metric-value">3.1 minutes (Longest)</span>
                </div>
                <div class="alert alert-info">
                    <strong>Profile:</strong> Experienced users who already know most content but appreciate comprehensive training.
                </div>
            </div>
            
            <div class="segment-card">
                <div class="segment-title">🚀 Segment 2: Fast Learners (n=19)</div>
                <div class="metric-row">
                    <span>Initial Knowledge:</span>
                    <span class="metric-value">2.00/5 (Low baseline)</span>
                </div>
                <div class="metric-row">
                    <span>Knowledge Improvement:</span>
                    <span class="metric-value">+2.11 points (Highest)</span>
                </div>
                <div class="metric-row">
                    <span>Content Satisfaction:</span>
                    <span class="metric-value">4.37/5 (Very Good)</span>
                </div>
                <div class="metric-row">
                    <span>Training Duration:</span>
                    <span class="metric-value">1.4 minutes (Optimal)</span>
                </div>
                <div class="alert alert-success">
                    <strong>Profile:</strong> New users who learn quickly and efficiently. Ideal target audience for training.
                </div>
            </div>
            
            <div class="segment-card">
                <div class="segment-title">⚠️ Segment 3: Struggling Learners (n=12)</div>
                <div class="metric-row">
                    <span>Initial Knowledge:</span>
                    <span class="metric-value">3.08/5 (Moderate baseline)</span>
                </div>
                <div class="metric-row">
                    <span>Knowledge Improvement:</span>
                    <span class="metric-value">+0.42 points (Lowest)</span>
                </div>
                <div class="metric-row">
                    <span>Content Satisfaction:</span>
                    <span class="metric-value">3.22/5 (Needs Improvement)</span>
                </div>
                <div class="metric-row">
                    <span>Training Duration:</span>
                    <span class="metric-value">1.5 minutes (Average)</span>
                </div>
                <div class="alert alert-warning">
                    <strong>Profile:</strong> Users who struggle with the current format. May need alternative training approaches.
                </div>
            </div>
        </div>
        
        <div class="chart-container">
            <div id="clustering-plot"></div>
        </div>
    </div>

    <!-- Correlations Tab -->
    <div id="correlations" class="tab-content">
        <div class="card-title">📊 Correlation Analysis & Feature Relationships</div>
        
        <div class="analytics-grid">
            <div class="analytics-card">
                <h3>Strongest Correlations with Knowledge Improvement</h3>
                <div class="metric-row">
                    <span class="metric-label">1. Initial Knowledge Level:</span>
                    <span class="metric-value">r = 0.822 (Very Strong)</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">2. User Access Improvement:</span>
                    <span class="metric-value">r = 0.606 (Strong)</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">3. Youth Roster Management:</span>
                    <span class="metric-value">r = 0.600 (Strong)</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">4. Visual Support Quality:</span>
                    <span class="metric-value">r = 0.546 (Moderate)</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">5. Content Relevance:</span>
                    <span class="metric-value">r = 0.527 (Moderate)</span>
                </div>
            </div>
            
            <div class="analytics-card">
                <h3>Key Insights</h3>
                <div class="alert alert-info">
                    <strong>Ceiling Effect:</strong> Participants with higher initial knowledge show smaller improvements.
                </div>
                <div class="alert alert-success">
                    <strong>Visual Learning:</strong> Strong correlation between visual support and learning outcomes.
                </div>
                <div class="alert alert-warning">
                    <strong>Duration Paradox:</strong> Longer training doesn't always mean better outcomes.
                </div>
            </div>
        </div>
        
        <div class="correlation-heatmap">
            <div id="correlation-heatmap"></div>
        </div>
    </div>

    <!-- Recommendations Tab -->
    <div id="recommendations" class="tab-content">
        <div class="card-title">💡 AI-Powered Recommendations</div>
        
        <div class="analytics-grid">
            <div class="analytics-card">
                <h3>Priority Action Items</h3>
                
                <div class="recommendation-item urgent">
                    <h4>🔥 URGENT: Improve Content Interactivity</h4>
                    <p><strong>Current Score:</strong> 3.58/5 | <strong>Improvement Potential:</strong> High</p>
                    <p>Add more interactive elements, quizzes, and hands-on exercises. This is the #1 factor for improving learning outcomes.</p>
                </div>
                
                <div class="recommendation-item high-priority">
                    <h4>⚡ HIGH PRIORITY: Optimize Training Duration</h4>
                    <p><strong>Finding:</strong> 1-2 minute sessions show best results</p>
                    <p>Segment longer content into bite-sized modules. Consider microlearning approach for better retention.</p>
                </div>
                
                <div class="recommendation-item">
                    <h4>📚 MEDIUM PRIORITY: Enhance Visual Support</h4>
                    <p><strong>Current Score:</strong> 4.46/5 | <strong>Status:</strong> Already Strong</p>
                    <p>Visual support is working well but could be leveraged more for struggling learners (Segment 3).</p>
                </div>
                
                <div class="recommendation-item">
                    <h4>🎯 SEGMENT-SPECIFIC: Personalized Paths</h4>
                    <p><strong>Fast Learners:</strong> Keep current format, add optional advanced content</p>
                    <p><strong>High Performers:</strong> Provide refresher mode, focus on new features</p>
                    <p><strong>Struggling Learners:</strong> Add more guidance, slower pace, additional support</p>
                </div>
            </div>
            
            <div class="analytics-card">
                <h3>Predictive Insights</h3>
                <div class="alert alert-success">
                    <strong>If interactivity improves to 4.5/5:</strong><br>
                    Expected increase in knowledge improvement: +0.3 points<br>
                    Estimated satisfaction boost: +0.4 points
                </div>
                
                <div class="alert alert-info">
                    <strong>ROI Analysis:</strong><br>
                    Investment in interactivity improvements could increase training effectiveness by 15-20% based on current correlation patterns.
                </div>
            </div>
        </div>
        
        <div class="chart-container">
            <canvas id="improvement-potential-chart"></canvas>
        </div>
    </div>

    <!-- Anomalies Tab -->
    <div id="anomalies" class="tab-content">
        <div class="card-title">🚨 Anomaly Detection & Quality Assurance</div>
        
        <div class="analytics-grid">
            <div class="analytics-card">
                <h3>Unusual Response Patterns</h3>
                
                <div class="alert alert-warning">
                    <h4>⚠️ Negative Knowledge Change Detected</h4>
                    <p><strong>Response ID:</strong> R_6eyHfukLaXjD24Y</p>
                    <p><strong>Pattern:</strong> Knowledge decreased from 5 to 3 (Δ-2.0)</p>
                    <p><strong>Recommendation:</strong> Follow up with this participant to understand what went wrong.</p>
                </div>
                
                <div class="alert alert-info">
                    <h4>📊 Statistical Outliers</h4>
                    <p><strong>Z-Score Threshold:</strong> |z| > 2.0</p>
                    <p><strong>Outliers Found:</strong> 1 out of 38 responses (2.6%)</p>
                    <p><strong>Status:</strong> Within normal range for survey data</p>
                </div>
            </div>
            
            <div class="analytics-card">
                <h3>Quality Metrics</h3>
                <div class="metric-row">
                    <span class="metric-label">Response Completion Rate:</span>
                    <span class="metric-value">100%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Data Quality Score:</span>
                    <span class="metric-value">97.4% (Excellent)</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Consistent Responses:</span>
                    <span class="metric-value">97.4%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Anomaly Rate:</span>
                    <span class="metric-value">2.6% (Normal)</span>
                </div>
            </div>
        </div>
        
        <div class="chart-container">
            <div id="anomaly-scatter-plot"></div>
        </div>
    </div>

    <!-- Statistical Insights Tab -->
    <div id="insights" class="tab-content">
        <div class="card-title">📈 Statistical Insights & Hypothesis Testing</div>
        
        <div class="analytics-grid">
            <div class="analytics-card">
                <h3>Hypothesis Test Results</h3>
                
                <div class="alert alert-info">
                    <h4>💻 Technical Issues vs Satisfaction</h4>
                    <p><strong>Hypothesis:</strong> Participants with technical issues have lower satisfaction</p>
                    <p><strong>Result:</strong> No significant difference found (p = 0.827)</p>
                    <p><strong>Interpretation:</strong> Technical issues don't significantly impact overall satisfaction</p>
                </div>
                
                <div class="alert alert-info">
                    <h4>🗺️ Regional Differences</h4>
                    <p><strong>Hypothesis:</strong> Satisfaction varies by geographic region</p>
                    <p><strong>Result:</strong> No significant differences (p = 0.517)</p>
                    <p><strong>Interpretation:</strong> Training effectiveness is consistent across Illinois regions</p>
                </div>
            </div>
            
            <div class="analytics-card">
                <h3>Sentiment Analysis</h3>
                <div class="metric-row">
                    <span class="metric-label">Comments Analyzed:</span>
                    <span class="metric-value">5 text responses</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Average Sentiment:</span>
                    <span class="metric-value">+0.80 (Positive)</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Positive Comments:</span>
                    <span class="metric-value">80%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Negative Comments:</span>
                    <span class="metric-value">0%</span>
                </div>
            </div>
        </div>
        
        <div class="chart-container">
            <canvas id="statistical-summary-chart"></canvas>
        </div>
    </div>

    <script>
        // Chart.js registration
        Chart.register(ChartDataLabels);
        
        // Sample data (in real implementation, this would come from your analytics backend)
        const analyticsData = {
            featureImportance: [
                { feature: 'Training Duration', importance: 0.307 },
                { feature: 'Visual Support', importance: 0.146 },
                { feature: 'Interactivity', importance: 0.114 },
                { feature: 'Understandability', importance: 0.111 },
                { feature: 'Relevance', importance: 0.085 },
                { feature: 'Engagement', importance: 0.077 },
                { feature: 'User Friendliness', importance: 0.070 },
                { feature: 'Tech Access', importance: 0.054 },
                { feature: 'Tech Navigation', importance: 0.036 }
            ],
            clusterData: [
                { segment: 'High Performers', x: 3.86, y: 0.57, size: 7, satisfaction: 4.55 },
                { segment: 'Fast Learners', x: 2.00, y: 2.11, size: 19, satisfaction: 4.37 },
                { segment: 'Struggling Learners', x: 3.08, y: 0.42, size: 12, satisfaction: 3.22 }
            ],
            correlationMatrix: [
                [1.00, 0.82, 0.61, 0.60, 0.55],
                [0.82, 1.00, 0.45, 0.52, 0.48],
                [0.61, 0.45, 1.00, 0.38, 0.42],
                [0.60, 0.52, 0.38, 1.00, 0.36],
                [0.55, 0.48, 0.42, 0.36, 1.00]
            ]
        };
        
        // Tab switching functionality
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => button.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Initialize charts for the active tab
            initializeTabCharts(tabName);
        }
        
        // Prediction functionality
        function updatePrediction() {
            const engaging = document.getElementById('content-engaging').value;
            const relevant = document.getElementById('content-relevant').value;
            const visual = document.getElementById('visual-support').value;
            const duration = document.getElementById('duration').value;
            
            // Update display values
            document.getElementById('engaging-value').textContent = engaging;
            document.getElementById('relevant-value').textContent = relevant;
            document.getElementById('visual-value').textContent = visual;
            document.getElementById('duration-value').textContent = duration;
            
            // Simple prediction model (in real implementation, this would call your ML API)
            const prediction = (
                engaging * 0.077 + 
                relevant * 0.085 + 
                visual * 0.146 + 
                duration * 0.307 - 0.5
            ).toFixed(1);
            
            const resultElement = document.getElementById('prediction-result');
            let color = '#28a745';
            if (prediction < 0.5) color = '#dc3545';
            else if (prediction < 1.0) color = '#ffc107';
            
            resultElement.innerHTML = `Predicted Knowledge Improvement: <strong style="color: ${color};">+${prediction} points</strong>`;
        }
        
        // Initialize charts based on active tab
        function initializeTabCharts(tabName) {
            switch(tabName) {
                case 'predictive':
                    createFeatureImportanceChart();
                    break;
                case 'clustering':
                    createClusteringPlot();
                    break;
                case 'correlations':
                    createCorrelationHeatmap();
                    break;
                case 'recommendations':
                    createImprovementPotentialChart();
                    break;
                case 'anomalies':
                    createAnomalyScatterPlot();
                    break;
                case 'insights':
                    createStatisticalSummaryChart();
                    break;
            }
        }
        
        // Feature Importance Chart
        function createFeatureImportanceChart() {
            const ctx = document.getElementById('feature-importance-chart');
            if (!ctx) return;
            
            const existingChart = Chart.getChart(ctx);
            if (existingChart) existingChart.destroy();
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: analyticsData.featureImportance.map(d => d.feature),
                    datasets: [{
                        label: 'Feature Importance',
                        data: analyticsData.featureImportance.map(d => d.importance),
                        backgroundColor: 'rgba(28, 69, 133, 0.8)',
                        borderColor: 'rgba(28, 69, 133, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Random Forest Feature Importance for Knowledge Improvement Prediction'
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Importance Score'
                            }
                        }
                    }
                }
            });
        }
        
        // Clustering Plot using Plotly
        function createClusteringPlot() {
            const plotDiv = document.getElementById('clustering-plot');
            if (!plotDiv) return;
            
            const traces = analyticsData.clusterData.map(d => ({
                x: [d.x],
                y: [d.y],
                mode: 'markers',
                type: 'scatter',
                marker: {
                    size: d.size * 3,
                    color: d.segment === 'High Performers' ? '#1c4585' : 
                           d.segment === 'Fast Learners' ? '#77b8e0' : '#efbe1b',
                    opacity: 0.8
                },
                name: d.segment,
                text: `${d.segment}<br>Size: ${d.size}<br>Satisfaction: ${d.satisfaction}`
            }));
            
            const layout = {
                title: 'Participant Segments: Initial Knowledge vs Knowledge Improvement',
                xaxis: { title: 'Initial Knowledge Level (1-5)' },
                yaxis: { title: 'Knowledge Improvement (points)' },
                showlegend: true,
                height: 400
            };
            
            Plotly.newPlot(plotDiv, traces, layout);
        }
        
        // Correlation Heatmap
        function createCorrelationHeatmap() {
            const plotDiv = document.getElementById('correlation-heatmap');
            if (!plotDiv) return;
            
            const data = [{
                z: analyticsData.correlationMatrix,
                x: ['Knowledge Improvement', 'Initial Knowledge', 'User Access', 'Youth Roster', 'Visual Support'],
                y: ['Knowledge Improvement', 'Initial Knowledge', 'User Access', 'Youth Roster', 'Visual Support'],
                type: 'heatmap',
                colorscale: 'RdBu',
                reversescale: true
            }];
            
            const layout = {
                title: 'Correlation Matrix: Key Training Variables',
                height: 500
            };
            
            Plotly.newPlot(plotDiv, data, layout);
        }
        
        // Improvement Potential Chart
        function createImprovementPotentialChart() {
            const ctx = document.getElementById('improvement-potential-chart');
            if (!ctx) return;
            
            const existingChart = Chart.getChart(ctx);
            if (existingChart) existingChart.destroy();
            
            const improvementData = [
                { feature: 'Content Interactivity', current: 3.58, potential: 0.162 },
                { feature: 'Content Understanding', current: 4.13, potential: 0.096 },
                { feature: 'Visual Support', current: 4.46, potential: 0.079 },
                { feature: 'Content Relevance', current: 4.30, potential: 0.060 },
                { feature: 'Content Engagement', current: 3.68, potential: 0.060 }
            ];
            
            new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Improvement Opportunities',
                        data: improvementData.map(d => ({ x: d.current, y: d.potential })),
                        backgroundColor: 'rgba(28, 69, 133, 0.8)',
                        borderColor: 'rgba(28, 69, 133, 1)',
                        pointRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Improvement Potential: Current Score vs Impact'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = improvementData[context.dataIndex];
                                    return `${point.feature}: Current ${point.current}/5, Impact ${point.potential}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Current Score (1-5)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Improvement Potential'
                            }
                        }
                    }
                }
            });
        }
        
        // Anomaly Scatter Plot
        function createAnomalyScatterPlot() {
            const plotDiv = document.getElementById('anomaly-scatter-plot');
            if (!plotDiv) return;
            
            // Sample data showing knowledge before vs after with anomaly highlighted
            const normalData = {
                x: [2, 3, 3, 3, 4, 4, 4, 5, 2, 3, 1, 2, 3, 4, 5],
                y: [5, 4, 4, 3, 4, 5, 4, 5, 4, 4, 4, 5, 4, 4, 5],
                mode: 'markers',
                type: 'scatter',
                marker: { color: '#1c4585', size: 8 },
                name: 'Normal Responses'
            };
            
            const anomalyData = {
                x: [5],
                y: [3],
                mode: 'markers',
                type: 'scatter',
                marker: { color: '#f15b28', size: 12, symbol: 'x' },
                name: 'Anomaly (Negative Learning)'
            };
            
            const layout = {
                title: 'Knowledge Before vs After: Anomaly Detection',
                xaxis: { title: 'Knowledge Before Training' },
                yaxis: { title: 'Knowledge After Training' },
                height: 400
            };
            
            Plotly.newPlot(plotDiv, [normalData, anomalyData], layout);
        }
        
        // Statistical Summary Chart
        function createStatisticalSummaryChart() {
            const ctx = document.getElementById('statistical-summary-chart');
            if (!ctx) return;
            
            const existingChart = Chart.getChart(ctx);
            if (existingChart) existingChart.destroy();
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Positive Sentiment', 'Neutral Sentiment', 'Negative Sentiment'],
                    datasets: [{
                        data: [80, 20, 0],
                        backgroundColor: [
                            'rgba(28, 69, 133, 0.8)',
                            'rgba(239, 190, 27, 0.8)',
                            'rgba(241, 91, 40, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Sentiment Analysis of Participant Comments'
                        }
                    }
                }
            });
        }
        
        // Initialize first tab
        document.addEventListener('DOMContentLoaded', function() {
            updatePrediction();
            initializeTabCharts('predictive');
        });
    </script>
</body>
</html>